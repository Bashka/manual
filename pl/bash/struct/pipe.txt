====== Потоки ======
Все внешние утилиты, функции и некоторые структуры в Bash могут использовать команды конвеера для перенаправления потоков ввода (strin или дескриптор 0), вывода (stdout или дескриптор 1) и ошибок (stderr или дескриптор 2). Для этого используются следующие конструкции:
  * ''`команда`'' - подстановка потока вывода на место вызова (команда имеет псевдоним ''$( ... )'');
<code bash>
result=`ls` # Результат работы ls будет помещен в переменную result
result=$( ls ) # Аналог предыдущей команды
</code>
  * ''(команда; команда)'' - объединение потоков вывода двух команд в один поток вывода;
  * ''команда | команда'' - перенаправление потока вывода первой команды в поток ввода второй;
  * ''команда дескриптор>файл|&дескриптор'' - перенаправление дескриптора (по умолчанию используется поток вывода) команды в файл или в указанный дескриптор (если указать в качестве первого дескриптора ''&'', перенаправлены будут все выходные потоки);
  * ''%%команда дескриптор>>файл|&дескриптор%%'' - аналог предыдущей конструкции, но использующий добавление, а не перезапись;
  * ''команда дескриптор<файл|&дескриптор'' - перенаправление потока файла или дескриптора в дескриптор команды (по умолчанию используется поток ввода);
  * ''exec дескриптор>файл|&дескриптор'' - перенаправление дескриптора сценария (по умолчанию используется поток вывода) в файл или в указанный дескриптор;
<code bash>
exec 3>log # Открытие дескриптора 3 на перезапись файла log.
</code>
  * ''%%exec дескриптор>>файл|&дескриптор%%'' - аналог предыдущей конструкции, но использующий добавление, а не перезапись;
  * ''exec дескриптор<файл|&дескриптор'' - перенаправление потока файла или дескриптора в дескриптор сценария;
<code bash>
exec 6<log # Открытие дескриптора 6 на чтение из файла log.
</code>
  * ''exec дескриптор>&-'' - закрыть дескриптор;
  * ''exec дескриптор<>файл'' - связать файл с дескриптором на ввод/вывод;
<code bash>
echo 'Hello' > test.txt
exec 3<>test.txt
read -n2 <&3 # Пропустить 2 символа
echo -n . >&3 # He.lo
exec 3>&- # Закрыть дескриптор
</code>
  * ''%%команда <<строка%%'' - перенаправление содержимого файла команды от текущей позиции до вхождения указанной строки в поток ввода команды.

Пример перенаправления потоков утилит:
<code bash>
ps | sort 2>&1 >result.db # Ошибки в вывод и в файл
</code>

Пример перенаправления потоков структуры ''for'':
<code bash>
for (( i = 10; $i >= 1; i-- )); do
  echo $i
done | sort > numbers.db
</code>

Пример перенаправления потоков структуры ''while'':
<code bash>
IFS="\n"
while read i; do # Построчное чтение потока ввода
  IFS=':'
  for j in $i; do # Пословное чтение каждой строки по разделителю
    echo -n $j
  done
  
  echo
  IFS="\n"
done < /etc/passwd # Содержимое файла в качестве потока ввода
</code>
<code bash>
IFS="\n"
# Помещение потока вывода цикла в переменную
result=$( cat /etc/passwd | while read i; do # Перенаправление прямо в цикл
  IFS=':'
  for j in $i; do
    echo -n $j
  done
  echo
  IFS="\n"
done )
</code>

~~DISQUS~~
